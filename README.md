# ModelVerify

> **æ–‡æ¡£æ›´æ–°æ—¥æœŸï¼š2026-01-08**

ä¸€ä¸ªç”¨äºéªŒè¯å’Œæµ‹è¯•æƒ¯æ€§å¯¼èˆªæ¨¡å‹çš„Pythonå·¥å…·åŒ…ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ§  **æ¨¡å‹åŠ è½½ä¸é¢„æµ‹**: æ”¯æŒåŠ è½½PyTorchæ¨¡å‹(.ptæ ¼å¼)è¿›è¡Œæƒ¯æ€§å¯¼èˆªé¢„æµ‹
- ğŸ“Š **æ•°æ®å¤„ç†**: æä¾›IMUæ•°æ®å’Œä½å§¿æ•°æ®çš„å¤„ç†ä¸æ’å€¼åŠŸèƒ½
- ğŸ¯ **æ‰¹é‡éªŒè¯**: æ”¯æŒå•ä¸ªæ•°æ®å•å…ƒå’Œæ•´ä¸ªæ•°æ®é›†çš„æ‰¹é‡æ¨¡å‹éªŒè¯
- ğŸ“ˆ **å¯è§†åŒ–**: é›†æˆRerun SDKè¿›è¡Œæ•°æ®å¯è§†åŒ–
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒå‘½ä»¤è¡Œå‚æ•°é…ç½®ï¼Œå¯è‡ªå®šä¹‰æ¨¡å‹å’Œæ•°æ®è·¯å¾„
- ğŸ“š **å®Œæ•´æ–‡æ¡£**: æä¾›è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

## ğŸ“š æ–‡æ¡£

æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ï¼š

- ğŸ“‹ [æ–‡æ¡£ä¸­å¿ƒ](docs/README.md) - æ–‡æ¡£å¯¼èˆªå’Œå­¦ä¹ è·¯å¾„
- ğŸš€ [å¿«é€Ÿå‚è€ƒ](docs/QUICKSTART.md) - å¸¸ç”¨å‘½ä»¤å’ŒAPIé€ŸæŸ¥æ‰‹å†Œ
- ğŸ“– [è¯¦ç»†ä½¿ç”¨æŒ‡å—](docs/USAGE.md) - å®Œæ•´çš„æ•°æ®æ ¼å¼è¯´æ˜å’ŒAPIä½¿ç”¨æ•™ç¨‹
- ğŸ“š [APIå‚è€ƒæ–‡æ¡£](docs/API.md) - æ‰€æœ‰ç±»å’Œå‡½æ•°çš„è¯¦ç»†APIæ–‡æ¡£

### æ ¸å¿ƒæ•™ç¨‹

- ğŸ”§ [æ•°æ®å‡†å¤‡](docs/USAGE.md#æ•°æ®å‡†å¤‡) - æ•°æ®æ ¼å¼å’Œæ ‡å®šè¯´æ˜
- ğŸ§  [æ¨¡å‹æ¨ç†](docs/USAGE.md#æ¨¡å‹æ¨ç†) - æ¨¡å‹åŠ è½½å’Œé¢„æµ‹æµç¨‹
- ğŸ“Š [ç»“æœè¯„ä¼°](docs/USAGE.md#ç»“æœè¯„ä¼°) - ATE/APE/RPEç­‰è¯„ä¼°æŒ‡æ ‡
- ğŸ¨ [å¯è§†åŒ–](docs/USAGE.md#å¯è§†åŒ–) - ä½¿ç”¨Rerunè¿›è¡Œæ•°æ®å¯è§†åŒ–

### é«˜çº§ä¸»é¢˜

- ğŸš€ [é«˜çº§ç”¨æ³•](docs/USAGE.md#é«˜çº§ç”¨æ³•) - æœ€ä½³å®è·µå’Œè‡ªå®šä¹‰æ–¹æ³•
- â“ [å¸¸è§é—®é¢˜](docs/USAGE.md#å¸¸è§é—®é¢˜) - é—®é¢˜æ’æŸ¥å’Œè§£å†³æ–¹æ¡ˆ


## å®‰è£…

### ç¯å¢ƒè¦æ±‚

- Python >= 3.11
- æ¨èä½¿ç”¨ `uv` ä½œä¸ºåŒ…ç®¡ç†å™¨

### å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨uvå®‰è£…ä¾èµ–
uv sync

# æˆ–ä½¿ç”¨pipå®‰è£…
pip install -e .
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# éªŒè¯å•ä¸ªæ•°æ®å•å…ƒ
python main.py -u <unit_path> -m model1.pt model2.pt

# éªŒè¯æ•´ä¸ªæ•°æ®é›†
python main.py -d <dataset_path> -m model1.pt model2.pt

# ä½¿ç”¨AHRSæ•°æ®
python main.py -u <unit_path> -m model1.pt --using_ahrs
```

### ğŸ“š æ›´å¤šæ–‡æ¡£

æŸ¥çœ‹ [è¯¦ç»†ä½¿ç”¨æŒ‡å—](docs/USAGE.md) è·å–æ›´å¤šä¿¡æ¯ï¼š

- ğŸ“– å®Œæ•´çš„æ•°æ®æ ¼å¼è¯´æ˜
- ğŸ”§ è¯¦ç»†çš„APIä½¿ç”¨ç¤ºä¾‹
- ğŸ“Š ç»“æœè¯„ä¼°ä¸å¯è§†åŒ–æ•™ç¨‹
- ğŸš€ é«˜çº§ç”¨æ³•å’Œæœ€ä½³å®è·µ
- â“ å¸¸è§é—®é¢˜è§£ç­”

### å‚æ•°è¯´æ˜

- `-u, --unit`: æŒ‡å®šå•ä¸ªæ•°æ®å•å…ƒè·¯å¾„
- `-d, --dataset`: æŒ‡å®šæ•°æ®é›†è·¯å¾„
- `-m, --models`: æŒ‡å®šè¦ä½¿ç”¨çš„æ¨¡å‹æ–‡ä»¶å(å¿…éœ€å‚æ•°ï¼Œå¯æŒ‡å®šå¤šä¸ª)
- `--using_ahrs`: ä½¿ç”¨AHRSæ•°æ®è€ŒéGTæ•°æ®æ—‹è½¬IMUæ•°æ®

## é¡¹ç›®ç»“æ„

```
ModelVerify/
â”œâ”€â”€ main.py              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ TLIOView.py          # TLIOæ•°æ®å¯è§†åŒ–
â”œâ”€â”€ base/                # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ args_parser.py   # å‘½ä»¤è¡Œå‚æ•°è§£æ
â”‚   â”œâ”€â”€ datatype.py      # æ•°æ®ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ device.py        # è®¾å¤‡é…ç½®
â”‚   â”œâ”€â”€ interpolate.py   # æ•°æ®æ’å€¼
â”‚   â”œâ”€â”€ model.py         # æ¨¡å‹åŠ è½½ä¸é¢„æµ‹
â”‚   â”œâ”€â”€ evaluate.py      # æ€§èƒ½è¯„ä¼°
â”‚   â”œâ”€â”€ rerun_ext.py     # Rerunæ‰©å±•
â”‚   â””â”€â”€ calibration/     # æ ‡å®šæ¨¡å—
â”œâ”€â”€ docs/                # è¯¦ç»†æ–‡æ¡£
â”‚   â””â”€â”€ USAGE.md         # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ datasets/            # æ•°æ®é›†ç›®å½•
â””â”€â”€ results/             # ç»“æœè¾“å‡ºç›®å½•
```

## æ ¸å¿ƒç»„ä»¶

### InerialNetwork
è´Ÿè´£åŠ è½½å’Œè¿è¡ŒPyTorchæ¨¡å‹çš„æ ¸å¿ƒç±»ï¼š

```python
from base.model import InerialNetwork

# åŠ è½½æ¨¡å‹
network = InerialNetwork("path/to/model.pt")

# è¿›è¡Œé¢„æµ‹
measurement, covariance = network.predict(input_data)
```

### æ•°æ®ç±»å‹
é¡¹ç›®å®šä¹‰äº†ä»¥ä¸‹æ ¸å¿ƒæ•°æ®ç±»å‹ï¼š

- `Pose`: ä½å§¿æ•°æ®(æ—‹è½¬+å¹³ç§»)
- `ImuData`: IMUä¼ æ„Ÿå™¨æ•°æ®
- `UnitData`: å•å…ƒæ•°æ®å®¹å™¨
- `DeviceDataset`: è®¾å¤‡æ•°æ®é›†

### æ•°æ®å¤„ç†
æä¾›å®Œæ•´çš„æ•°æ®å¤„ç†æµç¨‹ï¼š

- æ—¶é—´åºåˆ—æ’å€¼
- æ—‹è½¬æ’å€¼(SLERP)
- å‘é‡æ’å€¼
- æ•°æ®å¯¹é½å’Œé¢„å¤„ç†

## ä¾èµ–åŒ…

- `numpy>=2.3.5` - æ•°å€¼è®¡ç®—
- `pandas>=2.3.3` - æ•°æ®å¤„ç†
- `torch>=2.9.1` - æ·±åº¦å­¦ä¹ æ¡†æ¶
- `scipy>=1.16.3` - ç§‘å­¦è®¡ç®—
- `rerun-sdk>=0.27.2` - æ•°æ®å¯è§†åŒ–

## ä½¿ç”¨ç¤ºä¾‹

### 1. å•æ¨¡å‹éªŒè¯

```python
from base.model import ModelLoader, DataRunner, InertialNetworkData
from base.datatype import UnitData

# åŠ è½½æ¨¡å‹
loader = ModelLoader("/path/to/models")
model = loader.get_by_name("model.pt")

# åŠ è½½æ•°æ®
data = UnitData("/path/to/unit")

# è¿è¡Œé¢„æµ‹
runner = DataRunner(data, InertialNetworkData.set_step(20))
runner.predict(model)
```

### 2. æ•°æ®é›†æ‰¹é‡éªŒè¯

```python
from base.datatype import DeviceDataset
from base.model import ModelLoader, DataRunner, InertialNetworkData

# åŠ è½½æ•°æ®é›†
dataset = DeviceDataset("/path/to/dataset")

# åŠ è½½æ¨¡å‹
loader = ModelLoader("/path/to/models")
models = loader.get_by_names(["model1.pt", "model2.pt"])

# å¯¹æ¯ä¸ªæ•°æ®å•å…ƒè¿›è¡ŒéªŒè¯
for data in dataset:
    runner = DataRunner(data, InertialNetworkData.set_step(10))
    runner.predict_batch(models)
```

## å¼€å‘æŒ‡å—

è¯¦ç»†çš„å¼€å‘æŒ‡å—è¯·å‚è€ƒ [ä½¿ç”¨æŒ‡å—](docs/USAGE.md)ã€‚

### æ·»åŠ æ–°æ¨¡å‹

1. å°†æ¨¡å‹æ–‡ä»¶(.ptæ ¼å¼)æ”¾å…¥æ¨¡å‹ç›®å½•
2. åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨`-m`å‚æ•°æŒ‡å®šæ¨¡å‹åç§°

### æ‰©å±•æ•°æ®å¤„ç†

1. åœ¨`base/datatype.py`ä¸­å®šä¹‰æ–°çš„æ•°æ®ç±»å‹
2. åœ¨`base/interpolate.py`ä¸­æ·»åŠ ç›¸åº”çš„æ’å€¼æ–¹æ³•
3. æ›´æ–°`base/predict.py`ä¸­çš„å¤„ç†é€»è¾‘

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚
